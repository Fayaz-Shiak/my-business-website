<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phone Charging Tracker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
      }

      header {
        background-color: #4caf50;
        color: white;
        padding: 15px;
        text-align: center;
      }

      .container {
        width: 100%; /* Set full width */
        max-width: 1200px; /* Restrict the max width if you don't want it to stretch too much */
        margin: 0 auto; /* Center align the container */
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h2 {
        margin-bottom: 15px;
        font-size: 1.5em;
        color: #333;
      }

      .form-row {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-row .form-group {
        flex: 1;
      }

      .form-row .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        font-size: 14px;
        color: #555;
      }

      .form-row .form-group input,
      .form-row .form-group select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .form-row .form-group input[type="datetime-local"] {
        padding: 8px;
      }

      .form-row .form-group select {
        padding: 10px;
      }

      button {
        background-color: #4caf50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }

      button:hover {
        background-color: #45a049;
      }

      .search-bar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .search-bar input {
        width: 75%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .search-bar button {
        padding: 10px 15px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .search-bar button:hover {
        background-color: #555;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      table th,
      table td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }

      table th {
        background-color: #4caf50;
        color: white;
      }

      .paid {
        color: green;
        font-weight: bold;
      }

      .unpaid {
        color: red;
        font-weight: bold;
      }

      section {
        margin-top: 40px;
      }

      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        font-size: 20px;
        text-align: center;
        z-index: 1000;
        display: none;
      }

      /* About Us Section Styling */
      #about-us {
        padding: 10px;
        background-color: #f9f9f9;
        text-align: center;
      }

      #about-us h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: #333;
      }

      .team {
        display: flex;
        justify-content: space-between;
        flex-wrap: nowrap;
        gap: 5px;
      }

      .team-member {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 8px;
        width: 30%;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-sizing: border-box;
      }

      .team-member:hover {
        transform: translateY(-3px);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
      }

      .team-member h3 {
        font-size: 0.9rem;
        margin-bottom: 3px;
        color: #007bff;
      }

      .team-member p {
        font-size: 0.75rem;
        color: #555;
        margin: 3px 0;
        line-height: 1.1;
      }

      /* Footer Styling */
      footer {
        padding: 8px;
        background-color: #333;
        color: #fff;
        text-align: center;
        font-size: 0.75rem;
      }

      footer p {
        margin: 0;
        line-height: 1.2;
      }

      /* Responsive Styles */
      @media (max-width: 768px) {
        body {
          font-size: 14px; /* Reduce base font size for smaller screens */
        }

        .form-row {
          flex-direction: column; /* Stack form fields vertically */
          gap: 10px; /* Adjust spacing */
        }

        .team {
          flex-wrap: wrap; /* Allow wrapping of team members */
          gap: 10px;
        }

        .team-member {
          width: 100%; /* Each member takes full width */
          margin-bottom: 10px; /* Add some spacing between members */
        }

        .search-bar input {
          width: 100%; /* Input takes full width */
          margin-bottom: 10px; /* Add space between input and button */
        }

        .search-bar button {
          width: 100%; /* Button also takes full width */
        }

        .container {
          padding: 10px; /* Reduce padding for smaller screens */
          box-shadow: none; /* Optional: Remove shadow for simplicity */
        }

        table {
          font-size: 12px; /* Smaller font for table text */
        }

        table th,
        table td {
          padding: 5px; /* Reduce padding for table cells */
        }

        .popup {
          width: 90%; /* Make the popup fit smaller screens */
          font-size: 16px; /* Adjust font size */
        }

        header {
          font-size: 18px; /* Adjust font size for the header */
        }
      }

      @media (max-width: 480px) {
        h2 {
          font-size: 1.2em; /* Reduce heading size for very small screens */
        }

        button {
          padding: 10px; /* Adjust button padding */
          font-size: 14px; /* Adjust button font size */
        }

        footer {
          font-size: 10px; /* Smaller footer text */
        }
      }
      .search-bar {
        display: flex;
        flex-direction: row; /* Default: side by side for larger screens */
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-bar input {
        width: 100%; /* Take full width on smaller screens */
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .search-bar button {
        padding: 10px 15px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }

      .search-bar button:hover {
        background-color: #555;
      }

      /* Responsive styles for smaller screens */
      @media (max-width: 768px) {
        .search-bar {
          flex-direction: column; /* Stack elements vertically */
        }

        .search-bar button {
          width: 100%; /* Full width for the button */
        }
      }

      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        font-size: 20px;
        text-align: center;
        z-index: 1000;
        display: none;
        max-width: 80%; /* Ensure the popup does not take up too much space on mobile */
        word-wrap: break-word; /* Prevent text from overflowing */
      }

      @media (max-width: 600px) {
        .popup {
          padding: 15px 25px; /* Adjust padding for smaller screens */
          font-size: 16px; /* Reduce font size on smaller screens */
          max-width: 90%; /* Allow popup to use more space on smaller screens */
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Phone Charging Tracker</h1>
    </header>

    <div class="container">
      <!-- Search Bar -->
      <div class="search-bar">
        <input
          type="text"
          id="searchToken"
          placeholder="Enter Token Number to Search"
        />
        <button onclick="searchCustomer()">Search</button>
      </div>

      <h2>Add Customer</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="token">Token Number</label>
          <input type="text" id="token" placeholder="Enter Token Number" />
        </div>
        <div class="form-group">
          <label for="phone">Phone Model</label>
          <input type="text" id="phone" placeholder="Enter Phone Model" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startTime">Start Time (Optional)</label>
          <input type="datetime-local" id="startTime" />
        </div>
        <div class="form-group">
          <label for="paidStatus">Paid Status</label>
          <select id="paidStatus">
            <option value="Paid">Paid</option>
            <option value="Unpaid">Unpaid</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="duration">Duration (Optional - in minutes)</label>
          <input
            type="number"
            id="duration"
            placeholder="Enter duration in minutes (Optional)"
          />
        </div>
      </div>

      <button onclick="addCustomer()">Add Customer</button>

      <!-- Charging Sessions Tables -->
      <section>
        <h2>Current Charging Sessions</h2>
        <table>
          <thead>
            <tr>
              <th>Token</th>
              <th>Phone Model</th>
              <th>Start Time</th>
              <th>Minutes Elapsed</th>
              <th>Remaining Time</th>
              <th>Paid Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="currentSessions">
            <!-- Active customer rows will appear here -->
          </tbody>
        </table>
      </section>

      <section>
        <h2>Time Ended - Pending Pickup</h2>
        <table>
          <thead>
            <tr>
              <th>Token</th>
              <th>Phone Model</th>
              <th>Start Time</th>
              <th>Paid Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="timeEnded">
            <!-- Time-ended customer rows will appear here -->
          </tbody>
        </table>
      </section>

      <section>
        <h2>Completed Sessions</h2>
        <table>
          <thead>
            <tr>
              <th>Token</th>
              <th>Phone Model</th>
              <th>Start Time</th>
              <th>Paid Status</th>
            </tr>
          </thead>
          <tbody id="completedSessions">
            <!-- Completed customer rows will appear here -->
          </tbody>
        </table>
      </section>

      <button onclick="resetAllData()">Reset All Data</button>
    </div>
    <section id="about-us">
      <h2>About Us</h2>
      <div class="team">
        <div class="team-member">
          <h3>Fayaz</h3>
          
        </div>
        <div class="team-member">
          <h3>Sajith</h3>
          
        </div>
        <div class="team-member">
          <h3>Mahaboob</h3>
          
        </div>
      </div>
    </section>

    <footer>
      <p>© 2024 by Fayaz, Sajith, and Mahaboob. All rights reserved.</p>
    </footer>

    <script>
      const maxSessionTime = 60; // Maximum allowed session time in minutes (e.g., 60 minutes)

      // Retrieve stored session data from localStorage or initialize empty arrays
      let currentSessions =
        JSON.parse(localStorage.getItem("currentSessions")) || [];
      let timeEnded = JSON.parse(localStorage.getItem("timeEnded")) || [];
      let completedSessions =
        JSON.parse(localStorage.getItem("completedSessions")) || [];

      function showPopup(message) {
        const popup = document.createElement("div");
        popup.classList.add("popup");
        popup.innerText = message;

        document.body.appendChild(popup);
        popup.style.display = "block";

        setTimeout(() => {
          popup.style.display = "none";
          popup.remove();
        }, 2000); // Show popup for 2 seconds
      }

      function addCustomer() {
        const token = document.getElementById("token").value;
        const phone = document.getElementById("phone").value;
        const startTimeInput = document.getElementById("startTime").value;
        const paidStatus = document.getElementById("paidStatus").value;
        const durationInput = document.getElementById("duration").value; // Get the duration input

        if (!token || !phone) {
          alert("Please fill out all required fields!");
          return;
        }

        const startTime = startTimeInput
          ? new Date(startTimeInput)
          : new Date();
        const currentTime = new Date();

        if (startTime < currentTime) {
          alert(
            "The start time cannot be in the past. Please select a future time."
          );
          return; // Do not proceed if the start time is in the past
        }

        const duration = durationInput
          ? parseInt(durationInput)
          : maxSessionTime;

        const customer = {
          token,
          phone,
          startTime,
          paidStatus,
          duration,
          timer: setTimeout(() => moveToTimeEnded(token), duration * 60000),
        };

        currentSessions.push(customer);
        localStorage.setItem(
          "currentSessions",
          JSON.stringify(currentSessions)
        ); // Save to localStorage
        renderTables();
        resetForm();

        // Show popup for added customer
        showPopup(`Added to Charging: Token ${token}, Phone ${phone}`);
      }

      function moveToTimeEnded(token) {
        const index = currentSessions.findIndex((c) => c.token === token);
        if (index !== -1) {
          const [customer] = currentSessions.splice(index, 1);
          console.log(`Moved customer ${customer.token} to Time Ended`);
          timeEnded.push(customer);
          localStorage.setItem(
            "currentSessions",
            JSON.stringify(currentSessions)
          ); // Update localStorage
          localStorage.setItem("timeEnded", JSON.stringify(timeEnded)); // Update localStorage
          renderTables();

          // Show popup for ended session
          showPopup(
            `Phone Went to Ended: Token ${customer.token}, Phone ${customer.phone}`
          );
        } else {
          console.log(
            `Customer with token ${token} not found in currentSessions`
          );
        }
      }

      function moveToCompleted(token) {
        const index = timeEnded.findIndex((c) => c.token === token);
        if (index !== -1) {
          const [customer] = timeEnded.splice(index, 1);

          // Ensure the customer is marked as "Paid" when they move to the completed sessions
          customer.paidStatus = "Paid"; // Update the paid status to "Paid"

          completedSessions.push(customer);
          localStorage.setItem("timeEnded", JSON.stringify(timeEnded)); // Update localStorage
          localStorage.setItem(
            "completedSessions",
            JSON.stringify(completedSessions)
          ); // Update localStorage
          renderTables();
        }
      }

      function renderTables() {
        const currentTable = document.getElementById("currentSessions");
        const endedTable = document.getElementById("timeEnded");
        const completedTable = document.getElementById("completedSessions");

        // Clear the tables
        currentTable.innerHTML = "";
        endedTable.innerHTML = "";
        completedTable.innerHTML = "";

        // Render the current sessions table
        currentTable.innerHTML = `
                <tr>
                    <td colspan="7">Total Phones in Current Sessions: ${currentSessions.length}</td>
                </tr>
            `;
        currentSessions.forEach((customer) => {
          const currentTime = new Date();
          const startTime = new Date(customer.startTime);

          let elapsedTime = 0;
          let remainingTimeInSeconds = 0;
          let elapsedTimeText = "Not Started";
          let remainingTimeText = "Not Started";
          let remainingTimeColor = "green";

          // If start time is in the future, treat the session as waiting
          if (startTime > currentTime) {
            remainingTimeInSeconds = Math.floor(
              (startTime - currentTime) / 1000
            ); // Remaining time in seconds
          } else {
            // Once the start time has passed, calculate the elapsed time and remaining time
            elapsedTime = Math.floor((currentTime - startTime) / 1000); // Elapsed time in seconds
            remainingTimeInSeconds = customer.duration * 60 - elapsedTime; // Remaining time in seconds

            const minutesElapsed = Math.floor(elapsedTime / 60); // Minutes part of the elapsed time
            const secondsElapsed = elapsedTime % 60; // Seconds part of the elapsed time

            const remainingMinutes =
              remainingTimeInSeconds > 0
                ? Math.floor(remainingTimeInSeconds / 60)
                : 0;
            const remainingSeconds =
              remainingTimeInSeconds > 0 ? remainingTimeInSeconds % 60 : 0;

            // Display remaining time as red if less than or equal to 5 minutes
            remainingTimeColor =
              remainingTimeInSeconds <= 300 ? "red" : "green";

            elapsedTimeText = `${minutesElapsed}:${
              secondsElapsed < 10 ? "0" + secondsElapsed : secondsElapsed
            }`;
            remainingTimeText =
              remainingTimeInSeconds > 0
                ? `${remainingMinutes}:${
                    remainingSeconds < 10
                      ? "0" + remainingSeconds
                      : remainingSeconds
                  }`
                : "00:00";

            // If remaining time is 0 or less, move the customer to the "ended" state immediately
            if (remainingTimeInSeconds <= 0) {
              moveToTimeEnded(customer.token);
            }
          }

          const row = document.createElement("tr");

          // Update the startTime to show AM/PM format
          const formattedStartTime = startTime.toLocaleString("en-US", {
            weekday: "short",
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "numeric",
            second: "numeric",
            hour12: true, // This ensures AM/PM is included
          });

          row.innerHTML = `
                    <td>${customer.token}</td>
                    <td>${customer.phone}</td>
                    <td>${formattedStartTime}</td> <!-- AM/PM included here -->
                    <td>${elapsedTimeText}</td>
                    <td style="color:${remainingTimeColor};">${remainingTimeText}</td>
                    <td class="${customer.paidStatus.toLowerCase()}">${
            customer.paidStatus
          }</td>
                    <td><button onclick="confirmEndSession('${
                      customer.token
                    }')">End Session</button></td>
                `;

          currentTable.appendChild(row);
        });

        // Render the time-ended sessions table
        endedTable.innerHTML = `
                <tr>
                    <td colspan="5">Total Phones in Time-ended Sessions: ${timeEnded.length}</td>
                </tr>
            `;
        timeEnded.forEach((customer) => {
          const formattedStartTime = new Date(
            customer.startTime
          ).toLocaleString("en-US", {
            weekday: "short",
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "numeric",
            second: "numeric",
            hour12: true, // AM/PM included here as well
          });

          const row = document.createElement("tr");

          row.innerHTML = `
                    <td>${customer.token}</td>
                    <td>${customer.phone}</td>
                    <td>${formattedStartTime}</td> <!-- AM/PM included here -->
                    <td class="${customer.paidStatus.toLowerCase()}">${
            customer.paidStatus
          }</td>
                    <td><button onclick="moveToCompleted('${
                      customer.token
                    }')">Mark as Completed</button></td>
                `;

          endedTable.appendChild(row);
        });

        // Render the completed sessions table
        completedTable.innerHTML = `
                <tr>
                    <td colspan="4">Total Phones in Completed Sessions: ${completedSessions.length}</td>
                </tr>
            `;
        completedSessions.forEach((customer) => {
          const formattedStartTime = new Date(
            customer.startTime
          ).toLocaleString("en-US", {
            weekday: "short",
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "numeric",
            second: "numeric",
            hour12: true, // AM/PM included here
          });

          const row = document.createElement("tr");

          row.innerHTML = `
                    <td>${customer.token}</td>
                    <td>${customer.phone}</td>
                    <td>${formattedStartTime}</td> <!-- AM/PM included here -->
                    <td class="${customer.paidStatus.toLowerCase()}">${
            customer.paidStatus
          }</td>
                `;

          completedTable.appendChild(row);
        });
      }

      function confirmEndSession(token) {
        const confirmation = confirm(
          `Are you sure you want to end the session for Token: ${token}?`
        );
        if (confirmation) {
          moveToTimeEnded(token);
        }
      }

      function searchCustomer() {
        const searchToken = document.getElementById("searchToken").value.trim();
        const currentSession = currentSessions.find(
          (customer) => customer.token === searchToken
        );
        const endedSession = timeEnded.find(
          (customer) => customer.token === searchToken
        );
        const completedSession = completedSessions.find(
          (customer) => customer.token === searchToken
        );

        if (currentSession) {
          alert(
            `Customer found in Current Sessions:\nToken: ${currentSession.token}\nPhone Model: ${currentSession.phone}`
          );
        } else if (endedSession) {
          alert(
            `Customer found in Time Ended:\nToken: ${endedSession.token}\nPhone Model: ${endedSession.phone}`
          );
        } else if (completedSession) {
          alert(
            `Customer found in Completed Sessions:\nToken: ${completedSession.token}\nPhone Model: ${completedSession.phone}`
          );
        } else {
          alert("Customer not found!");
        }
        document.getElementById("searchToken").value = "";
      }

      function resetForm() {
        document.getElementById("token").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("startTime").value = "";
        document.getElementById("paidStatus").value = "Paid";
        document.getElementById("duration").value = "";
      }

      // Initial rendering of tables
      renderTables();
      function resetAllData() {
        localStorage.clear();
        currentSessions.length = 0;
        timeEnded.length = 0;
        completedSessions.length = 0;
        renderTables();
        alert("All data has been reset!");
      }

      setInterval(renderTables, 1000); // Refresh every second
    </script>
  </body>
</html>
